#!/usr/bin/env node
var It=Object.defineProperty;var w=(t,n)=>{for(var r in n)It(t,r,{get:n[r],enumerable:!0})};import Pr from"node:os";import Nr from"node:url";import Ut from"node:path";import{spawnSync as st}from"node:child_process";var Rt={_useHtmlParser2:!1};function T(t,n){if(!t)return n??Rt;let r={_useHtmlParser2:!!t.xmlMode,...n,...t};return t.xml?(r._useHtmlParser2=!0,r.xmlMode=!0,t.xml!==!0&&Object.assign(r,t.xml)):t.xmlMode&&(r._useHtmlParser2=!0),r}var F={};w(F,{contains:()=>C,extract:()=>Zt,html:()=>qt,merge:()=>ht,parseHTML:()=>Ft,root:()=>Wt,text:()=>$,xml:()=>zt});import{textContent as Bt}from"domutils";function lt(t,n,r){return t?t(n??t._root.children,null,void 0,r).toString():""}function Ht(t,n){return!n&&typeof t=="object"&&t!=null&&!("length"in t)&&!("type"in t)}function qt(t,n){let r=Ht(t)?(n=t,void 0):t,e={...this===null||this===void 0?void 0:this._options,...T(n)};return lt(this,r,e)}function zt(t){let n={...this._options,xmlMode:!0};return lt(this,t,n)}function $(t){let n=t??(this?this.root():[]),r="";for(let e=0;e<n.length;e++)r+=Bt(n[e]);return r}function Ft(t,n,r=typeof n=="boolean"?n:!1){if(!t||typeof t!="string")return null;typeof n=="boolean"&&(r=n);let e=this.load(t,this._options,!1);return r||e("script").remove(),[...e.root()[0].children]}function Wt(){return this(this._root)}function C(t,n){if(n===t)return!1;let r=n;for(;r&&r!==r.parent;)if(r=r.parent,r===t)return!0;return!1}function Zt(t){return this.root().extract(t)}function ht(t,n){if(!ut(t)||!ut(n))return;let r=t.length,e=+n.length;for(let i=0;i<e;i++)t[r++]=n[i];return t.length=r,t}function ut(t){if(Array.isArray(t))return!0;if(typeof t!="object"||t===null||!("length"in t)||typeof t.length!="number"||t.length<0)return!1;for(let n=0;n<t.length;n++)if(!(n in t))return!1;return!0}var X={};w(X,{addClass:()=>_t,attr:()=>Yt,data:()=>tn,hasClass:()=>en,prop:()=>Jt,removeAttr:()=>rn,removeClass:()=>bt,toggleClass:()=>At,val:()=>nn});function g(t){return t.cheerio!=null}function pt(t){return t.replace(/[._-](\w|$)/g,(n,r)=>r.toUpperCase())}function dt(t){return t.replace(/[A-Z]/g,"-$&").toLowerCase()}function l(t,n){let r=t.length;for(let e=0;e<r;e++)n(t[e],e);return t}var j;(function(t){t[t.LowerA=97]="LowerA",t[t.LowerZ=122]="LowerZ",t[t.UpperA=65]="UpperA",t[t.UpperZ=90]="UpperZ",t[t.Exclamation=33]="Exclamation"})(j||(j={}));function E(t){let n=t.indexOf("<");if(n<0||n>t.length-3)return!1;let r=t.charCodeAt(n+1);return(r>=j.LowerA&&r<=j.LowerZ||r>=j.UpperA&&r<=j.UpperZ||r===j.Exclamation)&&t.includes(">",n+2)}import{isTag as p}from"domhandler";import{innerText as Gt,textContent as Xt}from"domutils";var D=Object.prototype.hasOwnProperty,P=/\s+/,Z="data-",G=/^(?:autofocus|autoplay|async|checked|controls|defer|disabled|hidden|loop|multiple|open|readonly|required|scoped|selected)$/i,Vt=/^{[^]*}$|^\[[^]*]$/;function I(t,n,r){var e;if(!(!t||!p(t))){if((e=t.attribs)!==null&&e!==void 0||(t.attribs={}),!n)return t.attribs;if(D.call(t.attribs,n))return!r&&G.test(n)?n:t.attribs[n];if(t.name==="option"&&n==="value")return $(t.children);if(t.name==="input"&&(t.attribs.type==="radio"||t.attribs.type==="checkbox")&&n==="value")return"on"}}function L(t,n,r){r===null?yt(t,n):t.attribs[n]=`${r}`}function Yt(t,n){if(typeof t=="object"||n!==void 0){if(typeof n=="function"){if(typeof t!="string")throw new Error("Bad combination of arguments.");return l(this,(r,e)=>{p(r)&&L(r,t,n.call(r,e,r.attribs[t]))})}return l(this,r=>{if(p(r))if(typeof t=="object")for(let e of Object.keys(t)){let i=t[e];L(r,e,i)}else L(r,t,n)})}return arguments.length>1?this:I(this[0],t,this.options.xmlMode)}function mt(t,n,r){return n in t?t[n]:!r&&G.test(n)?I(t,n,!1)!==void 0:I(t,n,r)}function W(t,n,r,e){n in t?t[n]=r:L(t,n,!e&&G.test(n)?r?"":null:`${r}`)}function Jt(t,n){var r;if(typeof t=="string"&&n===void 0){let e=this[0];if(!e||!p(e))return;switch(t){case"style":{let i=this.css(),o=Object.keys(i);for(let s=0;s<o.length;s++)i[s]=o[s];return i.length=o.length,i}case"tagName":case"nodeName":return e.name.toUpperCase();case"href":case"src":{let i=(r=e.attribs)===null||r===void 0?void 0:r[t];return typeof URL<"u"&&(t==="href"&&(e.tagName==="a"||e.tagName==="link")||t==="src"&&(e.tagName==="img"||e.tagName==="iframe"||e.tagName==="audio"||e.tagName==="video"||e.tagName==="source"))&&i!==void 0&&this.options.baseURI?new URL(i,this.options.baseURI).href:i}case"innerText":return Gt(e);case"textContent":return Xt(e);case"outerHTML":return this.clone().wrap("<container />").parent().html();case"innerHTML":return this.html();default:return mt(e,t,this.options.xmlMode)}}if(typeof t=="object"||n!==void 0){if(typeof n=="function"){if(typeof t=="object")throw new TypeError("Bad combination of arguments.");return l(this,(e,i)=>{p(e)&&W(e,t,n.call(e,i,mt(e,t,this.options.xmlMode)),this.options.xmlMode)})}return l(this,e=>{if(p(e))if(typeof t=="object")for(let i of Object.keys(t)){let o=t[i];W(e,i,o,this.options.xmlMode)}else W(e,t,n,this.options.xmlMode)})}}function gt(t,n,r){var e;(e=t.data)!==null&&e!==void 0||(t.data={}),typeof n=="object"?Object.assign(t.data,n):typeof n=="string"&&r!==void 0&&(t.data[n]=r)}function Kt(t){for(let n of Object.keys(t.attribs)){if(!n.startsWith(Z))continue;let r=pt(n.slice(Z.length));D.call(t.data,r)||(t.data[r]=xt(t.attribs[n]))}return t.data}function Qt(t,n){let r=Z+dt(n),e=t.data;if(D.call(e,n))return e[n];if(D.call(t.attribs,r))return e[n]=xt(t.attribs[r])}function xt(t){if(t==="null")return null;if(t==="true")return!0;if(t==="false")return!1;let n=Number(t);if(t===String(n))return n;if(Vt.test(t))try{return JSON.parse(t)}catch{}return t}function tn(t,n){var r;let e=this[0];if(!e||!p(e))return;let i=e;return(r=i.data)!==null&&r!==void 0||(i.data={}),t==null?Kt(i):typeof t=="object"||n!==void 0?(l(this,o=>{p(o)&&(typeof t=="object"?gt(o,t):gt(o,t,n))}),this):Qt(i,t)}function nn(t){let n=arguments.length===0,r=this[0];if(!r||!p(r))return n?void 0:this;switch(r.name){case"textarea":return this.text(t);case"select":{let e=this.find("option:selected");if(!n){if(this.attr("multiple")==null&&typeof t=="object")return this;this.find("option").removeAttr("selected");let i=typeof t=="object"?t:[t];for(let o of i)this.find(`option[value="${o}"]`).attr("selected","");return this}return this.attr("multiple")?e.toArray().map(i=>$(i.children)):e.attr("value")}case"input":case"option":return n?this.attr("value"):this.attr("value",t)}}function yt(t,n){!t.attribs||!D.call(t.attribs,n)||delete t.attribs[n]}function R(t){return t?t.trim().split(P):[]}function rn(t){let n=R(t);for(let r of n)l(this,e=>{p(e)&&yt(e,r)});return this}function en(t){return this.toArray().some(n=>{let r=p(n)&&n.attribs.class,e=-1;if(r&&t.length>0)for(;(e=r.indexOf(t,e+1))>-1;){let i=e+t.length;if((e===0||P.test(r[e-1]))&&(i===r.length||P.test(r[i])))return!0}return!1})}function _t(t){if(typeof t=="function")return l(this,(e,i)=>{if(p(e)){let o=e.attribs.class||"";_t.call([e],t.call(e,i,o))}});if(!t||typeof t!="string")return this;let n=t.split(P),r=this.length;for(let e=0;e<r;e++){let i=this[e];if(!p(i))continue;let o=I(i,"class",!1);if(o){let s=` ${o} `;for(let c of n){let f=`${c} `;s.includes(` ${f}`)||(s+=f)}L(i,"class",s.trim())}else L(i,"class",n.join(" ").trim())}return this}function bt(t){if(typeof t=="function")return l(this,(i,o)=>{p(i)&&bt.call([i],t.call(i,o,i.attribs.class||""))});let n=R(t),r=n.length,e=arguments.length===0;return l(this,i=>{if(p(i))if(e)i.attribs.class="";else{let o=R(i.attribs.class),s=!1;for(let c=0;c<r;c++){let f=o.indexOf(n[c]);f>=0&&(o.splice(f,1),s=!0,c--)}s&&(i.attribs.class=o.join(" "))}})}function At(t,n){if(typeof t=="function")return l(this,(s,c)=>{p(s)&&At.call([s],t.call(s,c,s.attribs.class||"",n),n)});if(!t||typeof t!="string")return this;let r=t.split(P),e=r.length,i=typeof n=="boolean"?n?1:-1:0,o=this.length;for(let s=0;s<o;s++){let c=this[s];if(!p(c))continue;let f=R(c.attribs.class);for(let h=0;h<e;h++){let a=f.indexOf(r[h]);i>=0&&a<0?f.push(r[h]):i<=0&&a>=0&&f.splice(a,1)}c.attribs.class=f.join(" ")}return this}var Q={};w(Q,{_findBySelector:()=>un,add:()=>In,addBack:()=>Rn,children:()=>vn,closest:()=>dn,contents:()=>kn,each:()=>wn,end:()=>Cn,eq:()=>En,filter:()=>jn,filterArray:()=>K,find:()=>an,first:()=>Mn,get:()=>Dn,has:()=>Ln,index:()=>Nn,is:()=>Sn,last:()=>On,map:()=>$n,next:()=>mn,nextAll:()=>gn,nextUntil:()=>xn,not:()=>Tn,parent:()=>ln,parents:()=>hn,parentsUntil:()=>pn,prev:()=>yn,prevAll:()=>_n,prevUntil:()=>bn,siblings:()=>An,slice:()=>Un,toArray:()=>Pn});import{isTag as S,hasChildren as on,isDocument as B}from"domhandler";import*as x from"cheerio-select";import{getChildren as sn,getSiblings as cn,nextElementSibling as vt,prevElementSibling as kt,uniqueSort as H}from"domutils";var fn=/^\s*[+~]/;function an(t){if(!t)return this._make([]);if(typeof t!="string"){let n=g(t)?t.toArray():[t],r=this.toArray();return this._make(n.filter(e=>r.some(i=>C(i,e))))}return this._findBySelector(t,Number.POSITIVE_INFINITY)}function un(t,n){var r;let e=this.toArray(),i=fn.test(t)?e:this.children().toArray(),o={context:e,root:(r=this._root)===null||r===void 0?void 0:r[0],xmlMode:this.options.xmlMode,lowerCaseTags:this.options.lowerCaseTags,lowerCaseAttributeNames:this.options.lowerCaseAttributeNames,pseudos:this.options.pseudos,quirksMode:this.options.quirksMode};return this._make(x.select(t,i,o,n))}function V(t){return function(n,...r){return function(e){var i;let o=t(n,this);return e&&(o=K(o,e,this.options.xmlMode,(i=this._root)===null||i===void 0?void 0:i[0])),this._make(this.length>1&&o.length>1?r.reduce((s,c)=>c(s),o):o)}}}var N=V((t,n)=>{let r=[];for(let e=0;e<n.length;e++){let i=t(n[e]);i.length>0&&(r=r.concat(i))}return r}),Y=V((t,n)=>{let r=[];for(let e=0;e<n.length;e++){let i=t(n[e]);i!==null&&r.push(i)}return r});function J(t,...n){let r=null,e=V((i,o)=>{let s=[];return l(o,c=>{for(let f;(f=i(c))&&!r?.(f,s.length);c=f)s.push(f)}),s})(t,...n);return function(i,o){r=typeof i=="string"?c=>x.is(c,i,this.options):i?U(i):null;let s=e.call(this,o);return r=null,s}}function M(t){return t.length>1?Array.from(new Set(t)):t}var ln=Y(({parent:t})=>t&&!B(t)?t:null,M),hn=N(t=>{let n=[];for(;t.parent&&!B(t.parent);)n.push(t.parent),t=t.parent;return n},H,t=>t.reverse()),pn=J(({parent:t})=>t&&!B(t)?t:null,H,t=>t.reverse());function dn(t){var n;let r=[];if(!t)return this._make(r);let e={xmlMode:this.options.xmlMode,root:(n=this._root)===null||n===void 0?void 0:n[0]},i=typeof t=="string"?o=>x.is(o,t,e):U(t);return l(this,o=>{for(o&&!B(o)&&!S(o)&&(o=o.parent);o&&S(o);){if(i(o,0)){r.includes(o)||r.push(o);break}o=o.parent}}),this._make(r)}var mn=Y(t=>vt(t)),gn=N(t=>{let n=[];for(;t.next;)t=t.next,S(t)&&n.push(t);return n},M),xn=J(t=>vt(t),M),yn=Y(t=>kt(t)),_n=N(t=>{let n=[];for(;t.prev;)t=t.prev,S(t)&&n.push(t);return n},M),bn=J(t=>kt(t),M),An=N(t=>cn(t).filter(n=>S(n)&&n!==t),H),vn=N(t=>sn(t).filter(S),M);function kn(){let t=this.toArray().reduce((n,r)=>on(r)?n.concat(r.children):n,[]);return this._make(t)}function wn(t){let n=0,r=this.length;for(;n<r&&t.call(this[n],n,this[n])!==!1;)++n;return this}function $n(t){let n=[];for(let r=0;r<this.length;r++){let e=this[r],i=t.call(e,r,e);i!=null&&(n=n.concat(i))}return this._make(n)}function U(t){return typeof t=="function"?(n,r)=>t.call(n,r,n):g(t)?n=>Array.prototype.includes.call(t,n):function(n){return t===n}}function jn(t){var n;return this._make(K(this.toArray(),t,this.options.xmlMode,(n=this._root)===null||n===void 0?void 0:n[0]))}function K(t,n,r,e){return typeof n=="string"?x.filter(n,t,{xmlMode:r,root:e}):t.filter(U(n))}function Sn(t){let n=this.toArray();return typeof t=="string"?x.some(n.filter(S),t,this.options):t?n.some(U(t)):!1}function Tn(t){let n=this.toArray();if(typeof t=="string"){let r=new Set(x.filter(t,n,this.options));n=n.filter(e=>!r.has(e))}else{let r=U(t);n=n.filter((e,i)=>!r(e,i))}return this._make(n)}function Ln(t){return this.filter(typeof t=="string"?`:has(${t})`:(n,r)=>this._make(r).find(t).length>0)}function Mn(){return this.length>1?this._make(this[0]):this}function On(){return this.length>0?this._make(this[this.length-1]):this}function En(t){var n;return t=+t,t===0&&this.length<=1?this:(t<0&&(t=this.length+t),this._make((n=this[t])!==null&&n!==void 0?n:[]))}function Dn(t){return t==null?this.toArray():this[t<0?this.length+t:t]}function Pn(){return Array.prototype.slice.call(this)}function Nn(t){let n,r;return t==null?(n=this.parent().children(),r=this[0]):typeof t=="string"?(n=this._make(t),r=this[0]):(n=this,r=g(t)?t[0]:t),Array.prototype.indexOf.call(n,r)}function Un(t,n){return this._make(Array.prototype.slice.call(this,t,n))}function Cn(){var t;return(t=this.prevObject)!==null&&t!==void 0?t:this._make([])}function In(t,n){let r=this._make(t,n),e=H([...this.get(),...r.get()]);return this._make(e)}function Rn(t){return this.prevObject?this.add(t?this.prevObject.filter(t):this.prevObject):this}var nt={};w(nt,{_makeDomArray:()=>Gn,after:()=>rr,append:()=>Yn,appendTo:()=>Xn,before:()=>ir,clone:()=>hr,empty:()=>fr,html:()=>ar,insertAfter:()=>er,insertBefore:()=>or,prepend:()=>Jn,prependTo:()=>Vn,remove:()=>sr,replaceWith:()=>cr,text:()=>lr,toString:()=>ur,unwrap:()=>tr,wrap:()=>Kn,wrapAll:()=>nr,wrapInner:()=>Qn});import{isTag as zn,Text as Fn,hasChildren as y,cloneNode as tt,Document as Wn}from"domhandler";import{removeElement as Bn}from"domutils";import{Document as Hn,isDocument as qn}from"domhandler";function wt(t){return function(r,e,i,o){if(typeof Buffer<"u"&&Buffer.isBuffer(r)&&(r=r.toString()),typeof r=="string")return t(r,e,i,o);let s=r;if(!Array.isArray(s)&&qn(s))return s;let c=new Hn([]);return b(s,c),c}}function b(t,n){let r=Array.isArray(t)?t:[t];n?n.children=r:n=null;for(let e=0;e<r.length;e++){let i=r[e];i.parent&&i.parent.children!==r&&Bn(i),n?(i.prev=r[e-1]||null,i.next=r[e+1]||null):i.prev=i.next=null,i.parent=n}return n}import{removeElement as Zn}from"domutils";function Gn(t,n){if(t==null)return[];if(typeof t=="string")return this._parse(t,this.options,!1,null).children.slice(0);if("length"in t){if(t.length===1)return this._makeDomArray(t[0],n);let r=[];for(let e=0;e<t.length;e++){let i=t[e];if(typeof i=="object"){if(i==null)continue;if(!("length"in i)){r.push(n?tt(i,!0):i);continue}}r.push(...this._makeDomArray(i,n))}return r}return[n?tt(t,!0):t]}function $t(t){return function(...n){let r=this.length-1;return l(this,(e,i)=>{if(!y(e))return;let o=typeof n[0]=="function"?n[0].call(e,i,this._render(e.children)):n,s=this._makeDomArray(o,i<r);t(s,e.children,e)})}}function A(t,n,r,e,i){var o,s;let c=[n,r,...e],f=n===0?null:t[n-1],h=n+r>=t.length?null:t[n+r];for(let a=0;a<e.length;++a){let u=e[a],d=u.parent;if(d){let m=d.children.indexOf(u);m>-1&&(d.children.splice(m,1),i===d&&n>m&&c[0]--)}u.parent=i,u.prev&&(u.prev.next=(o=u.next)!==null&&o!==void 0?o:null),u.next&&(u.next.prev=(s=u.prev)!==null&&s!==void 0?s:null),u.prev=a===0?f:e[a-1],u.next=a===e.length-1?h:e[a+1]}return f&&(f.next=e[0]),h&&(h.prev=e[e.length-1]),t.splice(...c)}function Xn(t){return(g(t)?t:this._make(t)).append(this),this}function Vn(t){return(g(t)?t:this._make(t)).prepend(this),this}var Yn=$t((t,n,r)=>{A(n,n.length,0,t,r)}),Jn=$t((t,n,r)=>{A(n,0,0,t,r)});function jt(t){return function(n){let r=this.length-1,e=this.parents().last();for(let i=0;i<this.length;i++){let o=this[i],s=typeof n=="function"?n.call(o,i,o):typeof n=="string"&&!E(n)?e.find(n).clone():n,[c]=this._makeDomArray(s,i<r);if(!c||!y(c))continue;let f=c,h=0;for(;h<f.children.length;){let a=f.children[h];zn(a)?(f=a,h=0):h++}t(o,f,[c])}return this}}var Kn=jt((t,n,r)=>{let{parent:e}=t;if(!e)return;let i=e.children,o=i.indexOf(t);b([t],n),A(i,o,0,r,e)}),Qn=jt((t,n,r)=>{y(t)&&(b(t.children,n),b(r,t))});function tr(t){return this.parent(t).not("body").each((n,r)=>{this._make(r).replaceWith(r.children)}),this}function nr(t){let n=this[0];if(n){let r=this._make(typeof t=="function"?t.call(n,0,n):t).insertBefore(n),e;for(let o=0;o<r.length;o++)r[o].type==="tag"&&(e=r[o]);let i=0;for(;e&&i<e.children.length;){let o=e.children[i];o.type==="tag"?(e=o,i=0):i++}e&&this._make(e).append(this)}return this}function rr(...t){let n=this.length-1;return l(this,(r,e)=>{if(!y(r)||!r.parent)return;let i=r.parent.children,o=i.indexOf(r);if(o<0)return;let s=typeof t[0]=="function"?t[0].call(r,e,this._render(r.children)):t,c=this._makeDomArray(s,e<n);A(i,o+1,0,c,r.parent)})}function er(t){typeof t=="string"&&(t=this._make(t)),this.remove();let n=[];for(let r of this._makeDomArray(t)){let e=this.clone().toArray(),{parent:i}=r;if(!i)continue;let o=i.children,s=o.indexOf(r);s<0||(A(o,s+1,0,e,i),n.push(...e))}return this._make(n)}function ir(...t){let n=this.length-1;return l(this,(r,e)=>{if(!y(r)||!r.parent)return;let i=r.parent.children,o=i.indexOf(r);if(o<0)return;let s=typeof t[0]=="function"?t[0].call(r,e,this._render(r.children)):t,c=this._makeDomArray(s,e<n);A(i,o,0,c,r.parent)})}function or(t){let n=this._make(t);this.remove();let r=[];return l(n,e=>{let i=this.clone().toArray(),{parent:o}=e;if(!o)return;let s=o.children,c=s.indexOf(e);c<0||(A(s,c,0,i,o),r.push(...i))}),this._make(r)}function sr(t){let n=t?this.filter(t):this;return l(n,r=>{Zn(r),r.prev=r.next=r.parent=null}),this}function cr(t){return l(this,(n,r)=>{let{parent:e}=n;if(!e)return;let i=e.children,o=typeof t=="function"?t.call(n,r,n):t,s=this._makeDomArray(o);b(s,null);let c=i.indexOf(n);A(i,c,1,s,e),s.includes(n)||(n.parent=n.prev=n.next=null)})}function fr(){return l(this,t=>{if(y(t)){for(let n of t.children)n.next=n.prev=n.parent=null;t.children.length=0}})}function ar(t){if(t===void 0){let n=this[0];return!n||!y(n)?null:this._render(n.children)}return l(this,n=>{if(!y(n))return;for(let e of n.children)e.next=e.prev=e.parent=null;let r=g(t)?t.toArray():this._parse(`${t}`,this.options,!1,n).children;b(r,n)})}function ur(){return this._render(this)}function lr(t){return t===void 0?$(this):typeof t=="function"?l(this,(n,r)=>this._make(n).text(t.call(n,r,$([n])))):l(this,n=>{if(!y(n))return;for(let e of n.children)e.next=e.prev=e.parent=null;let r=new Fn(`${t}`);b(r,n)})}function hr(){let t=Array.prototype.map.call(this.get(),r=>tt(r,!0)),n=new Wn(t);for(let r of t)r.parent=n;return this._make(t)}var rt={};w(rt,{css:()=>pr});import{isTag as St}from"domhandler";function pr(t,n){if(t!=null&&n!=null||typeof t=="object"&&!Array.isArray(t))return l(this,(r,e)=>{St(r)&&Tt(r,t,n,e)});if(this.length!==0)return Lt(this[0],t)}function Tt(t,n,r,e){if(typeof n=="string"){let i=Lt(t),o=typeof r=="function"?r.call(t,e,i[n]):r;o===""?delete i[n]:o!=null&&(i[n]=o),t.attribs.style=dr(i)}else if(typeof n=="object"){let i=Object.keys(n);for(let o=0;o<i.length;o++){let s=i[o];Tt(t,s,n[s],o)}}}function Lt(t,n){if(!t||!St(t))return;let r=mr(t.attribs.style);if(typeof n=="string")return r[n];if(Array.isArray(n)){let e={};for(let i of n)r[i]!=null&&(e[i]=r[i]);return e}return r}function dr(t){return Object.keys(t).reduce((n,r)=>`${n}${n?" ":""}${r}: ${t[r]};`,"")}function mr(t){if(t=(t||"").trim(),!t)return{};let n={},r;for(let e of t.split(";")){let i=e.indexOf(":");if(i<1||i===e.length-1){let o=e.trimEnd();o.length>0&&r!==void 0&&(n[r]+=`;${o}`)}else r=e.slice(0,i).trim(),n[r]=e.slice(i+1).trim()}return n}var et={};w(et,{serialize:()=>yr,serializeArray:()=>_r});import{isTag as gr}from"domhandler";var Mt="input,select,textarea,keygen",xr=/%20/g,Ot=/\r?\n/g;function yr(){return this.serializeArray().map(r=>`${encodeURIComponent(r.name)}=${encodeURIComponent(r.value)}`).join("&").replace(xr,"+")}function _r(){return this.map((t,n)=>{let r=this._make(n);return gr(n)&&n.name==="form"?r.find(Mt).toArray():r.filter(Mt).toArray()}).filter('[name!=""]:enabled:not(:submit, :button, :image, :reset, :file):matches([checked], :not(:checkbox, :radio))').map((t,n)=>{var r;let e=this._make(n),i=e.attr("name"),o=(r=e.val())!==null&&r!==void 0?r:"";return Array.isArray(o)?o.map(s=>({name:i,value:s.replace(Ot,`\r
`)})):{name:i,value:o.replace(Ot,`\r
`)}}).toArray()}var it={};w(it,{extract:()=>Ar});function br(t){var n;return typeof t=="string"?{selector:t,value:"textContent"}:{selector:t.selector,value:(n=t.value)!==null&&n!==void 0?n:"textContent"}}function Ar(t){let n={};for(let r in t){let e=t[r],i=Array.isArray(e),{selector:o,value:s}=br(i?e[0]:e),c=typeof s=="function"?s:typeof s=="string"?f=>this._make(f).prop(s):f=>this._make(f).extract(s);if(i)n[r]=this._findBySelector(o,Number.POSITIVE_INFINITY).map((f,h)=>c(h,r,n)).get();else{let f=this._findBySelector(o,1);n[r]=f.length>0?c(f[0],r,n):void 0}}return n}var v=class{constructor(n,r,e){if(this.length=0,this.options=e,this._root=r,n){for(let i=0;i<n.length;i++)this[i]=n[i];this.length=n.length}}};v.prototype.cheerio="[cheerio object]";v.prototype.splice=Array.prototype.splice;v.prototype[Symbol.iterator]=Array.prototype[Symbol.iterator];Object.assign(v.prototype,X,Q,nt,rt,et,it);function Et(t,n){return function r(e,i,o=!0){if(e==null)throw new Error("cheerio.load() expects a string");let s=T(i),c=t(e,s,o,null);class f extends v{_make(u,d){let k=h(u,d);return k.prevObject=this,k}_parse(u,d,k,m){return t(u,d,k,m)}_render(u){return n(u,this.options)}}function h(a,u,d=c,k){if(a&&g(a))return a;let m=T(k,s),q=typeof d=="string"?[t(d,m,!1,null)]:"length"in d?d:[d],_=g(q)?q:new f(q,null,m);if(_._root=_,!a)return new f(void 0,_,m);let ct=typeof a=="string"&&E(a)?t(a,m,!1,null).children:vr(a)?[a]:Array.isArray(a)?a:void 0,ft=new f(ct,_,m);if(ct)return ft;if(typeof a!="string")throw new TypeError("Unexpected type of selector");let z=a,at=u?typeof u=="string"?E(u)?new f([t(u,m,!1,null)],_,m):(z=`${u} ${z}`,_):g(u)?u:new f(Array.isArray(u)?u:[u],_,m):_;return at?at.find(z):ft}return Object.assign(h,F,{load:r,_root:c,_options:s,fn:f.prototype,prototype:f.prototype}),h}}function vr(t){return!!t.name||t.type==="root"||t.type==="text"||t.type==="comment"}import{isDocument as kr}from"domhandler";import{parse as wr,parseFragment as $r,serializeOuter as jr}from"parse5";import{adapter as Dt}from"parse5-htmlparser2-tree-adapter";function Pt(t,n,r,e){var i;return(i=n.treeAdapter)!==null&&i!==void 0||(n.treeAdapter=Dt),n.scriptingEnabled!==!1&&(n.scriptingEnabled=!0),r?wr(t,n):$r(e,t,n)}var Sr={treeAdapter:Dt};function Nt(t){let n="length"in t?t:[t];for(let e=0;e<n.length;e+=1){let i=n[e];kr(i)&&Array.prototype.splice.call(n,e,1,...i.children)}let r="";for(let e=0;e<n.length;e+=1){let i=n[e];r+=jr(i,Sr)}return r}import Tr from"dom-serializer";import{parseDocument as Lr}from"htmlparser2";var Mr=wt((t,n,r,e)=>n._useHtmlParser2?Lr(t,n):Pt(t,n,r,e)),ot=Et(Mr,(t,n)=>n._useHtmlParser2?Tr(t,n):Nt(t));import{adapter as Se}from"parse5-htmlparser2-tree-adapter";import*as Or from"htmlparser2";import{ParserStream as Le}from"parse5-parser-stream";import{decodeBuffer as Oe,DecodeStream as Ee}from"encoding-sniffer";import*as Er from"undici";import Pe from"whatwg-mimetype";import{Writable as Ue,finished as Ce}from"node:stream";var Ze=Ut.join(Pr.tmpdir(),"soaper.tmp"),Ur=Ut.basename(Nr.fileURLToPath(import.meta.url)),Ct=process.argv.slice(2).join("%20");Ct||(console.log(`Usage: ${Ur} <SEARCH TERM>`),process.exit(1));var O="https://soaper.tv",Cr="/d/Videos/",Ir=async()=>{let t=`${O}/search.html?keyword=`,n=await fetch(t+Ct).then(o=>o.text()).then(o=>ot(o)),r=n("div.thumbnail");console.log("resultslength:",r.length),r.length===0&&(console.log("[info] Nothing found, try another search term"),process.exit(0));let e=[];return r.each((o,s)=>{let[c,f]=n(s).text().split(`
`).filter(a=>a!==""),h=n(s).find("h5 > a").attr("href");e.push(`[${c}] ${f.replaceAll(" ","_")} ${O+h}`)}),st(`echo "${e.join(`
`)}" | fzf --cycle --with-nth 1,2`,{stdio:["inherit","pipe","inherit"],shell:!0,encoding:"utf-8"}).stdout.replace(/\n$/,"")};async function Rr(){let t=await Ir();t||process.exit(1);let[n,r,e]=t.split(" "),i=`${r}_${n}`,o=t.includes("/tv"),c=await Br(e,o?"GetEInfoAjax":"GetMInfoAjax");if(console.log("links:",c),!o){if(c.subLink){let f=`${Cr}/${i}.eng.srt`;console.info(`[info] downloading subs to ${f}`),st(`curl ${O+c.subLink} -o ${f}`,{stdio:["inherit","inherit","inherit"],shell:!0,encoding:"utf-8"})}st(`yt-dlp '${O+c.m3u8Link}' -o ${i}.mp4`,{stdio:["inherit","inherit","inherit"],shell:!0,encoding:"utf-8"})}}async function Br(t,n){let r=t.match(/_(?<pass>.*)\.html/).groups.pass,e=await fetch(`${O}/home/index/${n}`,{headers:{"content-type":"application/x-www-form-urlencoded; charset=UTF-8",Referer:`${O}${t}`},body:`pass=${r}`,method:"POST"}).then(c=>c.json()),{subs:i,val:o}=e,s=i.find(c=>c.name.includes("en"));return{m3u8Link:o,subLink:s?.path?s.path:null}}Rr().catch(t=>{console.log(t),process.exit(1)});
